<!doctype html>
<html>
    <head>
        <link rel="stylesheet" href="jspm_packages/npm/codemirror@5.21.0/lib/codemirror.css"/>
        <link rel="stylesheet" href="stylesheets/grayscale.css"/>
        <link rel="stylesheet" href="stylesheets/reset.css"/>
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/favicon.ico" type="image/x-icon">
        <style>
            body {
                display: flex;
                flex-direction: row;
                font-family: Helvetica, Arial, sans-serif;
                padding-top: 5px;
            }

            body > * {
                flex: 1;
                height: 100%;
            }

            body > *:not(:last-child) {
                margin-right: 5px;
            }

            .CodeMirror {
                border: 1px solid hsl(0, 0%, 90%);
                height: auto;
                width: 100%;
            }

            #editorColumn {
                display: flex;
                flex-direction: column;
                width: 50vw;
            }

            #editorColumnContainer {
                overflow: auto;
                height: 100vh;
            }

            #log ul {
                list-style-type: disc;
            }

            #log li {
                margin-left: 15px;
            }

            #log li.error {
                color: hsl(0, 70.5%, 66.1%);
            }

            #log {
                height: 100px;
                overflow: auto;
            }

            #visualizationContainer {
                overflow: auto;
                /*position: fixed;*/
                width: 50vw;
            }

            .highlight {
                background-color: hsl(57, 81.7%, 95%);
            }

            /*#measure {
                position: fixed;
                top: 100%;
            }

            text {
                text-rendering: optimizeLegibility;
            }*/

            /*-------------------*/

            .contents {
                padding: 5px;
                padding-left: 0px;
                border: 1px solid hsl(0, 0%, 0%);
                border-top: none;
                overflow-x: hidden;
                background-color: rgba(245,245,220, .15);
            }

            .contents.collapsed > * {
                display: none;
            }

            .contents.collapsed {
                border: 2px solid black;
                padding: 0px;
            }

            .label {
                display: inline-block;
                font-family: Fira Sans, Helvetica, Arial, sans-serif;
                position: relative;
                left: 0px;
                white-space: pre;
                padding-left: 5px;
                transition: left 0.1s ease;
            }

            .infos {
                margin: 0px;
                margin-left: 5px;
                list-style-type: none;
                font-family: Signika, Helvetica, Arial, sans-serif;
                font-size: 8pt;
                padding: 0px;
            }

            #visualization {
                display: inline-flex;
                flex-direction: column;
                width: auto;
                padding: 5px;
            }

            #visualization > .call > .contents {
                border-top: 1px solid hsl(0, 0%, 0%);
            }

            .call {
                display: flex;
                flex-direction: column;
            }

            .call > .children {
                display: flex
            }

            .call:not(:last-child) {
                margin-right: 2px;
            }

            .call.callStack > .contents {
                font-weight: bold;
            }

        </style>
    </head>
    <body>
        <div id="visualizationContainer">
            <div id="visualization"></div>
        </div>
        <div id="editorColumnContainer">
        <div id="editorColumn">
            <ul id="log"></ul>
            <textarea id="query">
calls
	.query(call => call.isError)
	.select('.label')
		.style('color', 'red');

var sameArgs = {};
var argSets = [];

calls
    .query(call => call.fnName === 'fib')
	.forEach(call => {
    	let c = argSets.find(c => deepEquals(c.args, call.args));
		if (c !== undefined) {
            sameArgs[c.uid] = true;
            sameArgs[call.uid] = true;
    	} else {
			sameArgs[call.uid] = false;
            argSets.push(call);
        }
	});

calls
	.query(call => sameArgs[call.uid])
//	.style('background-color', swatches(6));

calls
	.query(call => call.fnName === 'fib')
    .info(call => call.args[0]);
            </textarea>
            <textarea id="editor">
var memo = {};

function fib(x) {
 // if (x in memo) {
 //   return memo[x];
 // }
  
  var ans;
  if (x < 2) {
    ans = x;
  } else {
    ans = fib(x-1) + fib(x-2);
  }
  memo[x] = ans;
  return ans;
}

fib(5);
            </textarea>
        </div>
        </div>
        <script src="jspm_packages/system.js"></script>
        <script src="config.js"></script>
        <script>
            System.import('src/index.js');
        </script>
    </body>
</html>